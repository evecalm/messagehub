/*!
 * @evecalm/message-hub v1.0.18
 * CopyrightÂ© 2021 Saiya https://github.com/oe/messagehub
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).MessageHub=n()}(this,(function(){"use strict";function e(e,n,t,r){return new(t||(t=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,u)}s((r=r.apply(e,n||[])).next())}))}function n(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}function t(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var r=Array(e),o=0;for(n=0;n<t;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r}var r=Math.random().toString(36).slice(2),o=self,i=0,a="undefined"==typeof document,u=[["*",{}]],s=[];o.addEventListener("message",p);var f={WINDOW_ID:r,on:function(e,n,t){var r,o=u.find((function(n){return n[0]===e}));if("string"==typeof n&&((r={})[n]=t,n=r),o){var i=o[1];o[1]="function"==typeof i||"function"==typeof n?n:Object.assign({},i,n)}else e instanceof Worker&&!s.includes(e)&&(s.push(e),e.addEventListener("message",p)),u["*"===e?"unshift":"push"]([e,n])},off:function(e){var n=u.findIndex((function(n){return n[0]===e}));if(-1!==n&&("*"===e?u[n][1]={}:u.splice(n,1)),e instanceof Worker){e.removeEventListener("message",p);var t=s.indexOf(e);t>-1&&s.splice(t,1)}},emit:function(e,n){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=c(n,t);return h(e,i),new Promise((function(n,t){var r=!a&&e instanceof Worker?e:o,u=function(e){var o=e.data;d(i,o)&&(r.removeEventListener("message",u),o.isSuccess?n(o.data):t(o.data))};r.addEventListener("message",u)}))},createDedicatedMessageHub:function(e){var n=e,r=function(){if(!n)throw new Error("peer is not set in dedicated message-hub")};return{setPeer:function(e){n=e},emit:function(e){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];return r(),f.emit.apply(f,t([n,e],o))},on:function(e,t){var o;r();var i="string"==typeof e?((o={})[e]=t,o):e;f.on(n,i)},off:function(e){if(r(),!e)return f.off(n);var t=u.find((function(e){return e[0]===n}));t&&delete t[e]}}},createProxy:function(e,n){if(a)throw new Error("[MessageHub] createProxy can only be used in a normal window context");if(o===e||o===n||e===n)throw new Error("[MessageHub] can not forward message to own");var r;f.on(e,(r=n,function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return f.emit.apply(f,t([r],e))}))},createProxyFor:function(e){f.createProxy(e,o.parent)}};function c(e,n){return{winID:r,msgID:++i,type:"request",methodName:e,args:n}}function l(e,n,t){return{winID:n.winID,msgID:n.msgID,type:"response",isSuccess:t,data:e}}function d(e,n){return e&&e&&n.winID===e.winID&&n.msgID===e.msgID&&"response"===n.type}function p(t){return e(this,void 0,void 0,(function(){var e,i,a,s,f,c,d,p,g;return n(this,(function(n){switch(n.label){case 0:if(e=t.data,i=t.source||t.currentTarget||o,!function(e){return e&&e.winID&&e.winID!==r&&e.msgID&&"request"===e.type}(e)||!i)return[2];n.label=1;case 1:if(n.trys.push([1,3,,4]),a=u.find((function(e){return e[0]===i}))||u[0],s=e.methodName,f=e.args,c=a&&a[1],d=void 0,"function"==typeof c?(d=c,f.unshift(s)):d=c&&c[s],"function"!=typeof d)throw console.warn("[MessageHub] no corresponding handler found for "+s+", message from",i),new Error("[MessageHub] no corresponding handler found for "+s);return[4,d.apply(null,f)];case 2:return p=n.sent(),h(i,l(p,e,!0)),[3,4];case 3:return g=n.sent(),h(i,l(g,e,!1)),[3,4];case 4:return[2]}}))}))}function h(e,n){var t=[n];"function"==typeof Window&&e instanceof Window&&t.push("*"),e.postMessage.apply(e,t)}return f}));
